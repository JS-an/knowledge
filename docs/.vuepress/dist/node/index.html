<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>pm2 | AllenBblog</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/page/logo.png">
    <meta name="description" content="">
    
    <link rel="preload" href="/page/assets/css/0.styles.94557e5c.css" as="style"><link rel="preload" href="/page/assets/js/app.dfc3742d.js" as="script"><link rel="preload" href="/page/assets/js/2.35bfb264.js" as="script"><link rel="preload" href="/page/assets/js/16.15f65bc4.js" as="script"><link rel="prefetch" href="/page/assets/js/10.3f243eea.js"><link rel="prefetch" href="/page/assets/js/11.62f11c06.js"><link rel="prefetch" href="/page/assets/js/12.b310eb07.js"><link rel="prefetch" href="/page/assets/js/13.93ed2ba0.js"><link rel="prefetch" href="/page/assets/js/14.d26a8fa5.js"><link rel="prefetch" href="/page/assets/js/15.9a089f53.js"><link rel="prefetch" href="/page/assets/js/17.041466f7.js"><link rel="prefetch" href="/page/assets/js/18.1b2aefde.js"><link rel="prefetch" href="/page/assets/js/19.a037b51b.js"><link rel="prefetch" href="/page/assets/js/20.10446303.js"><link rel="prefetch" href="/page/assets/js/21.6739b66d.js"><link rel="prefetch" href="/page/assets/js/22.d63898f0.js"><link rel="prefetch" href="/page/assets/js/3.ee309f7e.js"><link rel="prefetch" href="/page/assets/js/4.ac318266.js"><link rel="prefetch" href="/page/assets/js/5.66bb5b27.js"><link rel="prefetch" href="/page/assets/js/6.2990d6c9.js"><link rel="prefetch" href="/page/assets/js/7.85993d37.js"><link rel="prefetch" href="/page/assets/js/8.89a503e5.js"><link rel="prefetch" href="/page/assets/js/9.9c32905e.js">
    <link rel="stylesheet" href="/page/assets/css/0.styles.94557e5c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/page/" class="home-link router-link-active"><img src="/page/logo.png" alt="AllenBblog" class="logo"> <span class="site-name can-hide">AllenBblog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="HTML/CSS/JS" class="dropdown-title"><span class="title">HTML/CSS/JS</span> <span class="arrow down"></span></button> <button type="button" aria-label="HTML/CSS/JS" class="mobile-dropdown-title"><span class="title">HTML/CSS/JS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/page/html/" class="nav-link">
  HTML/HTML5
</a></li><li class="dropdown-item"><!----> <a href="/page/css/" class="nav-link">
  CSS/CSS3
</a></li><li class="dropdown-item"><!----> <a href="/page/js/" class="nav-link">
  JS/ES
</a></li><li class="dropdown-item"><!----> <a href="/page/ts/" class="nav-link">
  TypeScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/page/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/page/react/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/page/flutter/" class="nav-link">
  Flutter
</a></li><li class="dropdown-item"><!----> <a href="/page/wx/" class="nav-link">
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/page/ui/" class="nav-link">
  UI框架
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络基础" class="dropdown-title"><span class="title">网络基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络基础" class="mobile-dropdown-title"><span class="title">网络基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/page/http/" class="nav-link">
  HTTP
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/page/node/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  node
</a></li><li class="dropdown-item"><!----> <a href="/page/mongoDB/" class="nav-link">
  mongoDB
</a></li><li class="dropdown-item"><!----> <a href="/page/nginx/" class="nav-link">
  nginx
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端工具" class="dropdown-title"><span class="title">前端工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端工具" class="mobile-dropdown-title"><span class="title">前端工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/page/git/" class="nav-link">
  git
</a></li><li class="dropdown-item"><!----> <a href="/page/npm/" class="nav-link">
  npm
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="HTML/CSS/JS" class="dropdown-title"><span class="title">HTML/CSS/JS</span> <span class="arrow down"></span></button> <button type="button" aria-label="HTML/CSS/JS" class="mobile-dropdown-title"><span class="title">HTML/CSS/JS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/page/html/" class="nav-link">
  HTML/HTML5
</a></li><li class="dropdown-item"><!----> <a href="/page/css/" class="nav-link">
  CSS/CSS3
</a></li><li class="dropdown-item"><!----> <a href="/page/js/" class="nav-link">
  JS/ES
</a></li><li class="dropdown-item"><!----> <a href="/page/ts/" class="nav-link">
  TypeScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/page/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/page/react/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/page/flutter/" class="nav-link">
  Flutter
</a></li><li class="dropdown-item"><!----> <a href="/page/wx/" class="nav-link">
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/page/ui/" class="nav-link">
  UI框架
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络基础" class="dropdown-title"><span class="title">网络基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络基础" class="mobile-dropdown-title"><span class="title">网络基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/page/http/" class="nav-link">
  HTTP
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/page/node/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  node
</a></li><li class="dropdown-item"><!----> <a href="/page/mongoDB/" class="nav-link">
  mongoDB
</a></li><li class="dropdown-item"><!----> <a href="/page/nginx/" class="nav-link">
  nginx
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端工具" class="dropdown-title"><span class="title">前端工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端工具" class="mobile-dropdown-title"><span class="title">前端工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/page/git/" class="nav-link">
  git
</a></li><li class="dropdown-item"><!----> <a href="/page/npm/" class="nav-link">
  npm
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/page/node/" aria-current="page" class="active sidebar-link">node</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/page/node/#pm2" class="sidebar-link">pm2</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="pm2"><a href="#pm2" class="header-anchor">#</a> pm2</h2> <ol><li>安装 pm2
<code>npm install pm2 -g //全局安装</code></li> <li>启动 nodejs 项目</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code>pm2 start ./bin/www  <span class="token comment">#Express 项目启动</span>

pm2 start app.js <span class="token comment">#指定nodejs 项目入口文件启动</span>

pm2 start ./bin/www -i <span class="token number">4</span> --name <span class="token string">&quot;test&quot;</span> <span class="token comment"># -i 制定启动4个进程 --name 指定项目名字，重启/关闭时可以使用</span>

</code></pre></div><ol start="3"><li>查看已经启动项目</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code>pm2 list <span class="token comment">#完整</span>
pm2 <span class="token function">ls</span> <span class="token comment">#简化</span>
</code></pre></div><ol start="4"><li>重启 pm2 管理的项目</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code>pm2 restart <span class="token punctuation">[</span>id/name<span class="token punctuation">]</span> <span class="token comment">#重新启动制定项目 id或name</span>
pm2 restart all <span class="token comment">#重新启动所有项目</span>
</code></pre></div><ol start="5"><li>停止 pm2 管理的项目</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code>pm2 stop <span class="token punctuation">[</span>id/name<span class="token punctuation">]</span> <span class="token comment">#重新启动制定项目 id或name</span>
pm2 stop all <span class="token comment">#重新启动所有项目</span>
</code></pre></div><blockquote><p>Windows 用户注意
如果出现 启动项目成功，但是执行 pm2 list 后没有任何项目 说明你可能是没有将 pm2 加入 windows 服务中
执行如下代码安装</p></blockquote> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> i -g pm2-windows-service <span class="token comment">#首选安装 pm2-windows-service</span>
<span class="token comment"># 将pm2-service-install加入windows服务中，之后可以设置开机启动什么的，pm2-service-uninstall可以卸载服务</span>
pm2-service-install

</code></pre></div><ol start="6"><li>常用命令</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code> pm2 start app.js --name my-api <span class="token comment"># 命名进程</span>
 pm2 start app.js -i max  <span class="token comment"># 根据有效CPU数目启动最大进程数目</span>
 pm2 start app.js -i <span class="token number">3</span>      <span class="token comment"># 启动3个进程</span>
 pm2 start app.js -x        <span class="token comment">#用fork模式启动 app.js 而不是使用 cluster</span>
 pm2 start app.js -x -- -a <span class="token number">23</span>   <span class="token comment"># 用fork模式启动 app.js 并且传递参数 (-a 23)</span>
 pm2 start app.js --name serverone  <span class="token comment"># 启动一个进程并把它命名为 serverone</span>
 pm2 stop serverone       <span class="token comment"># 停止 serverone 进程</span>
 pm2 start app.json        <span class="token comment"># 启动进程, 在 app.json里设置选项</span>
 pm2 start app.js -i max -- -a <span class="token number">23</span>                   <span class="token comment">#在--之后给 app.js 传递参数</span>
 pm2 start app.js -i max -e err.log -o out.log  <span class="token comment"># 启动 并 生成一个配置文件，你也可以执行用其他语言编写的app  ( fork 模式):</span>
 pm2 start my-bash-script.sh    -x --interpreter <span class="token function">bash</span>
 pm2 start my-python-script.py -x --interpreter python

 pm2 list               <span class="token comment"># 显示所有进程状态</span>
 pm2 monit              <span class="token comment"># 监视所有进程</span>
 pm2 logs               <span class="token comment">#  显示所有进程日志</span>
 pm2 stop all           <span class="token comment"># 停止所有进程</span>
 pm2 restart all        <span class="token comment"># 重启所有进程</span>
 pm2 reload all         <span class="token comment"># 0秒停机重载进程 (用于 NETWORKED 进程)</span>
 pm2 stop <span class="token number">0</span>             <span class="token comment"># 停止指定的进程</span>
 pm2 restart <span class="token number">0</span>          <span class="token comment"># 重启指定的进程</span>
 pm2 startup            <span class="token comment"># 产生 init 脚本 保持进程活着</span>
 pm2 web                <span class="token comment"># 运行健壮的 computer API endpoint (http://localhost:9615)</span>
 pm2 delete <span class="token number">0</span>           <span class="token comment"># 杀死指定的进程</span>
 pm2 delete all         <span class="token comment"># 杀死全部进程</span>
</code></pre></div><ol start="7"><li>配置 pm2 启动文件
在项目根目录添加一个 processes.json：
内容如下:</li></ol> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;apps&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mywork&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;cwd&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/srv/node-app/current&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;script&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bin/www&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;log_date_format&quot;</span><span class="token operator">:</span> <span class="token string">&quot;YYYY-MM-DD HH:mm Z&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;error_file&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/var/log/node-app/node-app.stderr.log&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;out_file&quot;</span><span class="token operator">:</span> <span class="token string">&quot;log/node-app.stdout.log&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;pid_file&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pids/node-geo-api.pid&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;instances&quot;</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
      <span class="token property">&quot;min_uptime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;200s&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;max_restarts&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
      <span class="token property">&quot;max_memory_restart&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1M&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;cron_restart&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1 0 * * *&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;watch&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token property">&quot;merge_logs&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token property">&quot;exec_interpreter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;exec_mode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;fork&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;autorestart&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token property">&quot;vizion&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>说明:</p> <ul><li><p>apps:json 结构，apps 是一个数组，每一个数组成员就是对应一个 pm2 中运行的应用</p></li> <li><p>name:应用程序名称</p></li> <li><p>cwd:应用程序所在的目录</p></li> <li><p>script:应用程序的脚本路径</p></li> <li><p>log_date_format:</p></li> <li><p>error_file:自定义应用程序的错误日志文件</p></li> <li><p>out_file:自定义应用程序日志文件</p></li> <li><p>pid_file:自定义应用程序的 pid 文件</p></li> <li><p>instances: 实例数</p></li> <li><p>min_uptime:最小运行时间，这里设置的是 60s 即如果应用程序在 60s 内退出，pm2 会认为程序异常退出，此时触发重启 max_restarts 设置数量</p></li> <li><p>max_restarts:设置应用程序异常退出重启的次数，默认 15 次（从 0 开始计数）</p></li> <li><p>cron_restart:定时启动，解决重启能解决的问题</p></li> <li><p>watch:是否启用监控模式，默认是 false。如果设置成 true，当应用程序变动时，pm2 会自动重载。这里也可以设置你要监控的文件。</p></li> <li><p>merge_logs: 合并日志</p></li> <li><p>exec_interpreter:应用程序的脚本类型，这里使用的 shell，默认是 nodejs</p></li> <li><p>exec_mode:应用程序启动模式，这里设置的是 cluster_mode（集群），默认是 fork</p></li> <li><p>autorestart:启用/禁用应用程序崩溃或退出时自动重启</p></li> <li><p>vizion:启用/禁用 vizion 特性(版本控制)</p> <p>可以通过 pm2 start processes.json 来启动。
也可以把命令写在 package.json 里。如下:</p></li></ul> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;pm2&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pm2 start processes.json&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/page/assets/js/app.dfc3742d.js" defer></script><script src="/page/assets/js/2.35bfb264.js" defer></script><script src="/page/assets/js/16.15f65bc4.js" defer></script>
  </body>
</html>
